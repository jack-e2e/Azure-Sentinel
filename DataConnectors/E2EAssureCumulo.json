{
  "id": "E2EAssureCumulo",
  "title": "e2e-assure Cumulo NDR",
  "publisher": "e2e-assure",
  "descriptionMarkdown": "e2e-assure Cumulo NDR connector to push Cumulo Security Alert data into Azure Sentinel Log Analytics.",
  "graphQueries": [
    {
      "metricName": "Total number of alerts received",
      "legend": "CUMULO_ALERT_FEED_CL",
      "baseQuery": "CUMULO_ALERT_FEED_CL"
    },{
      "metricName": "Total number of Threat Briefs received",
      "legend": "CUMULO_THREAT_BRIEF_CL",
      "baseQuery": "CUMULO_THREAT_BRIEF_CL"
    },{
      "metricName": "Total number of alert attachments received",
      "legend": "CUMULO_ALERT_ATTACHMENT_CL",
      "baseQuery": "CUMULO_ALERT_ATTACHMENT_CL"
    }
  ],
  "sampleQueries": [
    {
      "description": "Top 10 most recent Cumulo Security Alerts",
      "query": "CUMULO_ALERT_FEED_CL | top 10 by TimeGenerated desc | project class_title_s,id_d,priority_title_s=case(isempty(priority_title_s), \"Untriaged\", priority_title_s),sub_status_title_s = case(isempty(sub_status_title_s), \"Needs Triage\", sub_status_title_s),editor_name_s=case(isempty(editor_name_s),\"Default\",editor_name_s),title_s,description_s,rule_name_s"
    },
    {
      "description":"10 Most recent Cumulo Threat Briefs",
      "query":"CUMULO_THREAT_BRIEF_CL | top 10 by TimeGenerated desc | project id_d, disclosure_date_s, title_s, original_detail_s, link_s, image_url_s"
    },{
      "description":"Show SNORT3 Related cumulo alert log attachment results",
      "query":"CUMULO_ALERT_ATTACHMENT_CL | project data = parse_json(extract_json(\"$[0].data[0]\", contents_s, typeof(string))) | evaluate bag_unpack(data) | where isnotempty(sig_msg) | project host, host_id, srcip, srcport, dstip, dstport, proto, sig_sid, sig_msg, msg"
    }
  ],
  "dataTypes": [
    {
      "name": "CUMULO_ALERT_FEED_CL",
      "lastDataReceivedQuery": "CUMULO_ALERT_FEED_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
    },
    {
      "name": "CUMULO_THREAT_BRIEF_CL",
      "lastDataReceivedQuery": "CUMULO_THREAT_BRIEF_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
    },
    {
      "name": "CUMULO_ALERT_ATTACHMENT_CL",
      "lastDataReceivedQuery": "CUMULO_ALERT_ATTACHMENT_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
    },
    {
      "name": "CUMULO_SOURCE_DATA_CL",
      "lastDataReceivedQuery": "CUMULO_SOURCE_DATA_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
    }
  ],
  "connectivityCriterias": [
    {
      "type": "IsConnectedQuery",
      "value": [
        "CUMULO_ALERT_FEED_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
      ]
    }
  ],
  "availability": {
    "status": 1,
    "isPreview": true
  },
  "permissions": {
    "resourceProvider": [
      {
        "provider": "Microsoft.OperationalInsights/workspaces",
        "permissionsDisplayText": "read and write permissions are required.",
        "providerDisplayName": "Workspace",
        "scope": "Workspace",
        "requiredPermissions": {
          "write": true,
          "read": true,
          "delete": true
        }
      },
      {
        "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
        "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
        "providerDisplayName": "Keys",
        "scope": "Workspace",
        "requiredPermissions": {
          "action": true
        }
      }
    ],
    "customs": [
      {
        "name": "Connectivity requires a configured Discovery module for Azure Sentinel in e2e Cumulo software platform",
        "description": "Please navigate to Discovery tab in Cumulo and follow instructions under Azure Sentinel Tab"
      }
    ]
  },
  "instructionSteps": [
    {
      "title": "e2e Cumulo Configuration Guide for Microsoft Sentinel",
      "description": "Follow [guidance](https://duke.e2e-cyberdev.com/e2eCumuloSentinelConfigurationGuide.pdf) for integrating e2e Cumulo Security Alerts logs with Azure Sentinel.",
      "instructions": [
        {
          "parameters": {
            "fillWith": [
              "WorkspaceId"
            ],
            "label": "Workspace ID"
          },
          "type": "CopyableLabel"
        },
        {
          "parameters": {
            "fillWith": [
              "PrimaryKey"
            ],
            "label": "Primary Key"
          },
          "type": "CopyableLabel"
        }
      ]
    }
  ],
  "metadata": {
    "id": "c32910c7-ad74-4267-ad3d-6a54ae7101ab",
    "version": "1.0.0",
    "kind": "dataConnector",
    "source": {
      "kind": "solution",
      "name": "e2e-assure Cumulo"
    },
    "author": {
      "name": "e2e-cyber"
    },
    "support": {
      "tier": "developer",
      "name": "e2e-assure Ltd",
      "email": "support@e2e-assure.com",
      "link":"www.e2e-assure.com"
    }
  }
}