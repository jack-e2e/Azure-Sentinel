{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "\r\n## CUMULO ALERT DETAILS\r\n\r\nView the details of behind the cumulo alert - by selecting the alert number in the parameter below"
      },
      "name": "text - 0"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "f4de6fdd-ea43-490f-87af-52b32a98e1fd",
            "version": "KqlParameterItem/1.0",
            "name": "CumuloAlertId",
            "label": "Cumulo Alert Id",
            "type": 2,
            "description": "Alert Id will be used to retrieve alert attachment data",
            "isRequired": true,
            "query": "CUMULO_ALERT_FEED_CL\r\n| where TimeGenerated > ago(30d) | project id_d\r\n",
            "value": "",
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "parameters - 0"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "CUMULO_ALERT_FEED_CL | where id_d == {CumuloAlertId} | limit 1 | project class_title_s, status_title_s, priority_title_s,  title_s, description_s, created_s | evaluate narrow() | project Property = Column, Value",
        "size": 0,
        "title": "Alert Details",
        "timeContext": {
          "durationMs": 86400000
        },
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "gridSettings": {
          "sortBy": [
            {
              "itemKey": "Value",
              "sortOrder": 2
            }
          ]
        },
        "sortBy": [
          {
            "itemKey": "Value",
            "sortOrder": 2
          }
        ]
      },
      "customWidth": "50",
      "name": "query - 0",
      "styleSettings": {
        "maxWidth": "33%"
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "CUMULO_ALERT_ATTACHMENT_CL | where alert_id_d == {CumuloAlertId}  and filename_s contains 'Rule' | project data = parse_json(extract_json(\"$[0].data[0]\", contents_s, typeof(string))) | evaluate bag_unpack(data) | evaluate narrow() | project Property = Column, Value",
        "size": 0,
        "title": "Alert Rule Results",
        "timeContext": {
          "durationMs": 86400000
        },
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "gridSettings": {
          "sortBy": [
            {
              "itemKey": "Value",
              "sortOrder": 2
            }
          ]
        },
        "sortBy": [
          {
            "itemKey": "Value",
            "sortOrder": 2
          }
        ]
      },
      "customWidth": "50",
      "name": "query - 1",
      "styleSettings": {
        "maxWidth": "33%"
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let descr = CUMULO_ALERT_FEED_CL | where id_d == {CumuloAlertId} | project description_s | limit 1;\r\n\r\nunion withsource=_TableName CUMULO_ALERT_FEED_CL | where description_s in (descr) | summarize Count=count() by  case(isempty(priority_title_s), \"Needs Triage\", priority_title_s)\r\n| render piechart",
        "size": 1,
        "title": "Alerts generated by the same rule within last 24h",
        "timeContext": {
          "durationMs": 86400000
        },
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "customWidth": "50",
      "name": "query - 2",
      "styleSettings": {
        "maxWidth": "33%"
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "CUMULO_ALERT_ATTACHMENT_CL\r\n | where alert_id_d == {CumuloAlertId}\r\n  | project TimeGenerated, alert_id_d, filename_s, query = extract_json(\"$[0].queryText\", contents_s, typeof(string)), data = extract_json(\"$[0].data\", contents_s, typeof(string))",
        "size": 0,
        "title": "Available Alert Attachments",
        "timeContext": {
          "durationMs": 86400000
        },
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "query - 3"
    }
  ],
  "fallbackResourceIds": [],
  "fromTemplateId": "sentinel-e2e-assure-CumuloAlertDetails",
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}